#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
#  banco.py
#  
#  Copyright 2020 lykos users <lykos@linux-byxd>

class cnab:
	
	def leituraItau400(self,tipo,arquivo):
		print arquivo
		registro = 1
		retorno = {}
		""" Layout CNAB
			file:///home/lykos/Downloads/Cobran%C3%A7a%20Banc%C3%A1ria%20(1).pdf
		"""
		conteudo = open(arquivo, 'r')
		for i in conteudo.readlines():

			if i[:1] in ['0','9'] and tipo in [0,9]:

				if i[:1]=='0': #--// REGISTRO HEADER 

					p01 = i[:1]         # TIPO DE REGISTRO IDENTIFICAÇÃO DO REGISTRO HEADER 001 001 9(01) 0
					p02 = i[1:2]        # CÓDIGO DE RETORNO IDENTIFICAÇÃO DO ARQUIVO RETORNO 002 002 9(01) 2
					p03 = i[2:9]        # LITERAL DE RETORNO IDENTIFICAÇÃO. POR EXTENSO DO TIPO DE MOVIMENTO 003 009 X(07) RETORNO
					p04 = i[9:11]       # CÓDIGO DO SERVIÇO IDENTIFICAÇÃO DO TIPO DE SERVIÇO 010 011 9(02) 01
					p05 = i[11:26]      # LITERAL DE SERVIÇO IDENTIFICAÇÃO POR EXTENSO DO TIPO DE SERVIÇO 012 026 X(15) COBRANCA
					p06 = i[26:30]      # AGÊNCIA AGÊNCIA MANTENEDORA DA CONTA 027 030 9(04)
					p07 = i[30:32]      # ZEROS COMPLEMENTO DE REGISTRO 031 032 9(02) “00”
					p08 = i[32:37]      # CONTA NÚMERO DA CONTA CORRENTE DA EMPRESA 033 037 9(05)
					p09 = i[37:38]      # DAC DÍGITO DE AUTO CONFERÊNCIA AG/CONTA EMPRESA 038 038 9(01)
					p10 = i[38:46]      # BRANCOS COMPLEMENTO DO REGISTRO 039 046 X(08)
					p11 = i[46:76]      # NOME DA EMPRESA NOME POR EXTENSO DA "EMPRESA MÃE" 047 076 X(30)

					p12 = i[76:79]      # CÓDIGO DO BANCO NÚMERO DO BANCO NA CÂMARA DE COMPENSAÇÃO 077 079 9(03) 341
					p13 = i[79:94]      # NOME DO BANCO NOME POR EXTENSO DO BANCO COBRADOR 080 094 X(15) BANCO ITAU SA
					p14 = i[94:100]     # DATA DE GERAÇÃO DATA DE GERAÇÃO DO ARQUIVO 095 100 9(06) DDMMAA
					p15 = i[100:105]    # DENSIDADE UNIDADE DA DENSIDADE 101 105 9(05)
					p16 = i[105:108]    # UNIDADE DE DENSID. DENSIDADE DE GRAVAÇÃO DO ARQUIVO 106 108 X(03) BPI
					p17 = i[108:113]    # Nº SEQ. ARQUIVO RET. NÚMERO SEQÜENCIAL DO ARQUIVO RETORNO 109 113 9(05)
					p18 = i[113:119]    # DATA DE CRÉDITO DATA DE CRÉDITO DOS LANÇAMENTOS 114 119 9(06) DDMMAA
					p19 = i[119:394]    # BRANCOS COMPLEMENTO DO REGISTRO 120 394 X(275)
					p20 = i[394:400]    # NÚMERO SEQÜENCIAL NÚMERO SEQÜENCIAL DO REGISTRO NO ARQUIVO 395 400 9(06) 000001

					retorno = p01, p02, p03, p04, p05, p06, p07, p08, p09, p10, p11, p12, p13, p14, p15, p16, p17, p18, p19, p20

				elif i[:1]=='9': #--// REGISTRO TRAILER
					f01 = i[:1]         # TIPO DE REGISTRO IDENTIFICAÇÃO DO REGISTRO TRAILER 001 001 9(01) 9
					f02 = i[1:2]        # CÓDIGO DE RETORNO IDENTIFICAÇÃO DE ARQUIVO RETORNO 002 002 9(01) 2
					f03 = i[2:4]        # CÓDIGO DE SERVIÇO IDENTIFICAÇÃO DO TIPO DE SERVIÇO 003 004 9(02) 01
					f04 = i[4:7]        # CÓDIGO DO BANCO IDENTIFICAÇÃO DO BANCO NA COMPENSAÇÃO 005 007 9(03) 341
					f05 = i[7:17]       # BRANCOS COMPLEMENTO DE REGISTRO 008 017 X(10)
					f06 = i[17:25]      # QTDE. DE TÍTULOS QTDE. DE TÍTULOS EM COBR. SIMPLES 018 025 9(08) NOTA 21
					f07 = i[25:39]      # VALOR TOTAL VR TOTAL DOS TÍTULOS EM COBRANÇA SIMPLES 026 039 9(12)V9(2) NOTA 21
					f08 = i[39:47]      # AVISO BANCÁRIO REFERÊNCIA DO AVISO BANCÁRIO 040 047 X(08) NOTA 22
					f09 = i[47:57]      # BRANCOS COMPLEMENTO DO REGISTRO 048 057 X(10)
					f10 = i[57:65]      # QTDE. DE TÍTULOS QTDE DE TÍTULOS EM COBRANÇA/VINCULADA 058 065 9(08) NOTA 21 

					f11 = i[65:79]      # VALOR TOTAL VR TOTAL DOS TÍTULOS EM COBRANÇA/VINCULADA 066 079 9(12)V9(2) NOTA 21
					f12 = i[79:87]      # AVISO BANCÁRIO REFERÊNCIA DO AVISO BANCÁRIO 080 087 X(08) NOTA 22
					f13 = i[87:177]      # BRANCOS COMPLEMENTO DO REGISTRO 088 177 X(90)
					f14 = i[177:185]      # QTDE. DE TÍTULOS QTDE. DE TÍTULOS EM COBR. DIRETA./ESCRITURAL 178 185 9(08) NOTA 21
					f15 = i[185:199]      # VALOR TOTAL VR TOTAL DOS TÍTULOS EM COBR. DIRETA/ESCRIT. 186 199 9(12)V9(2) NOTA 21
					f16 = i[199:207]      # AVISO BANCÁRIO REFERÊNCIA DO AVISO BANCÁRIO 200 207 X(08) NOTA 22
					f17 = i[207:212]      # CONTROLE DO ARQUIVO NÚMERO SEQÜENCIAL DO ARQUIVO RETORNO 208 212 9(05)
					f18 = i[212:220]      # QTDE DE DETALHES QUANTIDADE DE REGISTROS DE TRANSAÇÃO 213 220 9(08)
					f19 = i[220:234]      # VLR TOTAL INFORMADO VALOR DOS TÍTULOS INFORMADOS NO ARQUIVO 221 234 9(12)V9(2)
					f20 = i[234:394]      # BRANCOS COMPLEMENTO DO REGISTRO 235 394 X(160)
					f21 = i[394:400]      # NÚMERO SEQÜENCIAL NÚMERO SEQÜENCIAL DO REGISTRO NO ARQUIVO 395 400 9(06) 

					retorno = f01, f02, f03, f04, f05, f06, f07, f08, f09, f10, f11, f12, f13, f14, f15, f16, f17, f18, f19, f20, f21

			elif tipo==1: #--// REGISTRO TRANSAÇÃO
				if i[:1] not in ['0','9']:
					t01 = i[:1]         # TIPO DE REGISTRO IDENTIFICAÇÃO DO REGISTRO TRANSAÇÃO 001 001 9(01) 1
					t02 = i[1:3]        # CÓDIGO DE INSCRIÇÃO IDENTIFICAÇÃO DO TIPO DE INSCRIÇÃO/EMPRESA 002 003 9(02) 01=CPF 02=CGC
					t03 = i[3:17]       # NÚMERO DE INSCRIÇÃO NÚMERO DE INSCRIÇÃO DA EMPRESA (CPF/CGC) 004 017 9(14)
					t04 = i[17:21]      # AGÊNCIA AGÊNCIA MANTENEDORA DA CONTA 018 021 9(04)
					t05 = i[21:23]      # ZEROS COMPLEMENTO DE REGISTRO 022 023 9(02) “00”
					t06 = i[23:28]      # CONTA NÚMERO DA CONTA CORRENTE DA EMPRESA 024 028 9(05)
					t07 = i[28:29]      # DAC DÍGITO DE AUTO CONFERÊNCIA AG/CONTA EMPRESA 029 029 9(01)
					t08 = i[29:37]      # BRANCOS COMPLEMENTO DE REGISTRO 030 037 X(08)
					t09 = i[37:62]      # USO DA EMPRESA IDENTIFICAÇÃO DO TÍTULO NA EMPRESA 038 062 X(25) NOTA 2
					t10 = i[62:70]      # NOSSO NÚMERO IDENTIFICAÇÃO DO TÍTULO NO BANCO 063 070 9(08)
					t11 = i[70:82]      # BRANCOS COMPLEMENTO DO REGISTRO 071 082 X(12)
					t12 = i[82:85]      # CARTEIRA NUMERO DA CARTEIRA 083 085 9(03) NOTA 5
					t13 = i[85:93]      # NOSSO NÚMERO IDENTIFICAÇÃO DO TÍTULO NO BANCO 086 093 9(08) NOTA 3
					
					t14 = i[93:94]      # DAC NOSSO NÚMERO DAC DO NOSSO NÚMERO 094 094 9(01) NOTA 3
					t15 = i[94:107]     # BRANCOS COMPLEMENTO DO REGISTRO 095 107 X(13)
					t16 = i[107:108]    # CARTEIRA CÓDIGO DA CARTEIRA 108 108 X(01) NOTA 5
					t17 = i[108:110]    # CÓD. DE OCORRÊNCIA IDENTIFICAÇÃO DA OCORRÊNCIA 109 110 9(02) NOTA 17
					t18 = i[110:116]    # DATA DE OCORRÊNCIA DATA DE OCORRÊNCIA NO BANCO 111 116 9(06) DDMMAA
					
					t19 = i[116:126]     # Nº DO DOCUMENTO Nº DO DOCUMENTO DE COBRANÇA (DUPL, NP ETC) 117 126 X(10) NOTA 18
					t20 = i[126:134]     # NOSSO NÚMERO CONFIRMAÇÃO DO NÚMERO DO TÍTULO NO BANCO 127 134 9(08)
					t21 = i[134:146]     # BRANCOS COMPLEMENTO DO REGISTRO 135 146 X(12)
					t22 = i[146:152]     # VENCIMENTO DATA DE VENCIMENTO DO TÍTULO 147 152 9(06) DDMMAA
					t23 = i[152:165]     # VALOR DO TÍTULO VALOR NOMINAL DO TÍTULO 153 165 9(11)V9(2)
					t24 = i[165:168]     # CÓDIGO DO BANCO NÚMERO DO BANCO NA CÂMARA DE COMPENSAÇÃO 166 168 9(03)
					t25 = i[168:172]     # AGÊNCIA COBRADORA AG. COBRADORA, AG. DE LIQUIDAÇÃO OU BAIXA 169 172 9(04) NOTA 9
					t26 = i[172:173]     # DAC AG. COBRADORA DAC DA AGÊNCIA COBRADORA 173 173 9(01) 
					t27 = i[173:175]     # ESPÉCIE ESPÉCIE DO TÍTULO 174 175 9(02) NOTA 10
					t28 = i[175:188]     # TARIFA DE COBRANÇA VALOR DA DESPESA DE COBRANÇA 176 188 9(11)V9(2)

					t29 = i[188:214]     # BRANCOS COMPLEMENTO DO REGISTRO 189 214 X(26)
					t30 = i[214:227]     # VALOR DO IOF VALOR DO IOF A SER RECOLHIDO (NOTAS SEGURO) 215 227 9(11)V9(2)
					t31 = i[227:240]     # VALOR ABATIMENTO VALOR DO ABATIMENTO CONCEDIDO 228 240 9(11)V((2) NOTA 19
					t32 = i[240:253]     # DESCONTOS VALOR DO DESCONTO CONCEDIDO 241 253 9(11)V9(2) NOTA 19
					t33 = i[253:266]     # VALOR PRINCIPAL VALOR LANÇADO EM CONTA CORRENTE 254 266 9(11)V9(2)
					t34 = i[266:279]     # JUROS DE MORA/MULTA VALOR DE MORA E MULTA PAGOS PELO SACADO 267 279 9(11)V9(2)
					t35 = i[279:295]     # BRANCOS COMPLEMENTO DO REGISTRO 280 295 X(16) 

					t36 = i[295:301]      # DATA CRÉDITO DATA DE CRÉDITO DESTA LIQUIDAÇÃO 296 301 9(06) DDMMAA
					t37 = i[301:305]      # INSTR.CANCELADA CÓDIGO DA INSTRUÇÃO CANCELADA 302 305 9(04) NOTA 20
					t38 = i[305:324]      # BRANCOS COMPLEMENTO DE REGISTRO 306 324 X(19)
					t39 = i[324:354]      # NOME DO SACADO NOME DO SACADO 325 354 X(30)
					t40 = i[354:377]      # BRANCOS COMPLEMENTO DO REGISTRO 355 377 X(23)
					t41 = i[377:385]      # ERROS REGISTROS REJEITADOS OU ALEGAÇÃO DO SACADO 378 385 X(08) NOTA 20
					t42 = i[385:392]      # BRANCOS COMPLEMENTO DO REGISTRO 386 392 X(07)
					t43 = i[392:394]      # CÓD. DE LIQUIDAÇÃO MEIO PELO QUAL O TÍTULO FOI LIQUIDADO 393 394 X(02) NOTA 28
					t44 = i[394:400]      # NÚMERO SEQÜENCIAL NÚMERO SEQÜENCIAL DO REGISTRO NO ARQUIVO 395 400 9(06) 

					retorno[str(registro).zfill(4)] = t01,t02,t03,t04,t05,t06,t07,t08,t09,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19,t20,t21,t22,t23,t24,t25,t26,t27,t28,t29,t30,t31,t32,t33,t34,t35,t36,t37,t38,t39,t40,t41,t42,t43,t44
					registro +=1

		return retorno
		
#	a = leituraItau400(1)
#	for x in sorted (a):
		
#		print a[x][24]
